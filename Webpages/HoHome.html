<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="/CSS/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <style>

      * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
      /* Reserve Section in Columns */
      .reserve {
        display: flex;
        justify-content: center; /* Centers content horizontally */
        gap: 20%; /* Space between the buttons */
        text-align: center;
        flex-wrap: wrap; /* Allows buttons to wrap on smaller screens */
      }
 
      .reservetext1 {
        font-size: 40px;
        font-family: "Inter";
        color: #3e0408;
        font-weight: bold;
        margin-top: 20px;
        text-align: center;
        width: 100%; /* Ensure the text takes up full width */
      }
 
      .reserve-item {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
 
      .reserve button {
        border: 2px solid #3e0408;
        background: transparent;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
      }
 
      .reserve button:hover {
        background-color: #3e0408;
        color: #ffffff;
        transform: scale(1.1);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }
 
      .reserve button img {
        width: 300px;
        height: 300px;
      }
 
      .reserve button:hover img {
        filter: brightness(1.2);
      }
 
      .reservetext,
      .raisetext {
        font-size: 20px;
        font-family: "Inter";
        color: #3e0408;
        font-weight: bold;
        margin-top: 10px;
        padding-top: 20px;
      }
      .button {
      margin-top: auto;
      margin-bottom: 20px; /* Adjust this as needed */
      width: 100%;
      text-align: center;
 
 
    }
 
      /* Responsive adjustments for smaller screens */
      @media (max-width: 600px) {
        .search-bar {
          width: 100%;
        }
 
        .top-bar {
          padding: 0 10px;
        }
 
        .reserve {
          flex-direction: column; /* Stack buttons vertically on small screens */
          gap: 20px;
        }
 
        .reservetext1 {
          font-size: 30px; /* Adjust the size for smaller screens */
        }
      }
 
      .popup {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1001;
    justify-content: center;
    align-items: center;
    font-family: sans-serif;
}

.popup-content {
    background-color: #ffffff; 
    color: #000000; 
    padding: 20px;
    border: 2px solid #af2630; 
    border-radius: 8px;
    width: 900px;
    height: auto;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    box-sizing: border-box;
    font-family: sans-serif;
    position: relative; 
}

.popup-top-bar {
    background-color: #af2630; 
    color: #ffffff; 
    padding: 10px;
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    border-top-left-radius: 8px; 
    border-top-right-radius: 8px;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
}

.popup-content-inner {
    margin-top: 60px; 
}

.popup-content label {
    display: block;
    margin: 10px 0 5px;
    font-size: 20px;
    font-weight: bold;
}

.popup-content input[type="text"],
.popup-content textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
    font-size: 20px;
}

.popup-content textarea {
    resize: none;
}

.popup-buttons {
    display: flex;
    align-items: center;
    justify-content: space-between; 
}


#closePopup {
    background-color: #fff;
    color: #af2630;
    border: 2px solid #af2630;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    font-size: 20px;
    transition: all 0.3s ease;
    margin-right: auto; 
}

#closePopup:hover {
    background-color: #d9d9d9;
    border-color: #d9d9d9;
}

#sendButton {
    background-color: #fff;
    color: #af2630;
    border: 2px solid #af2630;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    font-size: 20px;
    transition: all 0.3s ease;
}

#sendButton:hover {
    background-color: #d9d9d9;
    border-color: #d9d9d9;
}

.file-container {
  align-self: flex-end;  
  margin-top: 10px;
}
        .notification-icon {
            position: fixed;
            top: 12px;
            right: 20px;
            cursor: pointer;
            z-index: 1000;
        }
 
        .notification-icon img {
            width: 30px;
            height: 30px;
        }
 
        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
        }
 
        .notification-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #AF2630;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            max-width: 80%;
            width: 400px;
 
 
        }
 
        .notification-modal h2 {
            margin-top: 0;
            color: #AF2630;
        }
 
        .notification-list {
            max-height: 300px;
            overflow-y: auto;
        }
 
        .notification-item {
            /* ... (keep existing styles) ... */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .proceed-to-payment-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .proceed-to-payment-btn:hover {
            background-color: #218838;
        }
        .notification-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #AF2630;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            max-width: 80%;
            width: 400px;
            color: white;
        }

        .notification-modal h2 {
            margin: 0 0 20px 0;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .notification-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .notification-item {
            /* ... (keep existing styles) ... */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .proceed-to-payment-btn {
            background-color: #FFB6C1; /* Light pink */
            color: #333; /* Darker text for better contrast */
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .proceed-to-payment-btn:hover {
            background-color: #FFC0CB; /* Slightly different pink on hover */
        }
        .notification-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #AF2630;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            max-width: 80%;
            width: 600px; /* Increased from 400px */
            color: white;
        }

        .notification-modal h2 {
            margin: 0 0 20px 0;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .notification-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .notification-item {
            background-color: #af2630;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center; /* Changed from flex-start */
            gap: 12px;
        }

        .notification-checkbox {
            margin: 0; /* Remove top margin */
        }

        .notification-content {
            flex-grow: 1;
            background-color: white;
            border: white;
            border-radius: 5px;
        }

        .notification-message {
            color: #af2630;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .notification-timestamp {
            color: #AF2630;
            font-size: 12px;
        }

        .proceed-to-payment-btn {
            background-color: #FFB6C1; /* Light pink */
            color: black; /* Darker text for better contrast */
            font-weight: bold;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
            white-space: nowrap;
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.2;
        }

        .proceed-to-payment-btn:hover {
            background-color: #FFC0CB; /* Slightly different pink on hover */
        }

        .notification-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .clear-btn {
            background-color: white;
            color: #333;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .clear-btn:hover {
            background-color: #e9ecef;
        }

        .no-notifications {
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 16px;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
        }

        .close-modal:hover {
            opacity: 0.8;
        }
        /* Mobile CSS*/

        @media screen and (max-width: 768px) {
            /* Sidebar becomes bottom navigation */
            .side-bar {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 70px;
                padding: 0;
                display: flex;
                justify-content: space-around;
                align-items: center;
                background-color: #D9D9D9;
                z-index: 1000;
            }

            .Home, .Calendar, .Profile {
                margin: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .Home img, .Calendar img, .Profile img {
                width: 30px;
                height: 30px;
            }

            .Home p, .Calendar p, .Profile p {
                margin-top: 4px;
                font-size: 12px;
            }

            /* Welcome section adjustments */
            .Welcome {
                margin-left: 0;
                padding: 20px;
                text-align: center;
            }

            .Welcome h1 {
                font-size: 24px;
                margin-bottom: 15px;
            }

            .avidalogo {
                width: 200px;
            }

            /* Reserve section adjustments */
            .reserve {
                padding: 20px;
                margin-bottom: 80px;
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }

            .reservetext1 {
                font-size: 24px;
                margin-bottom: 20px;
            }

            .reserve-item {
                width: 100%;
                max-width: 300px;
            }

            .reserve button img {
                width: 200px;
                height: 200px;
            }

            /* Popup improvements */
            .popup-content {
                width: 95%;
                max-width: 400px;
                margin: 10px;
                height: auto;
                max-height: 90vh;
            }

            .popup-content-inner {
                margin-top: 50px;
                padding: 10px;
            }

            /* Form inputs */
            .popup-content input[type="text"],
            .popup-content textarea {
                font-size: 16px;
                padding: 12px;
            }

            /* Notification adjustments */
            .notification-icon {
                top: 10px;
                right: 10px;
            }

            .notification-modal {
                width: 95%;
                height: auto;
                max-height: 90vh;
                margin: 10px;
            }

            .notification-item {
                padding: 12px;
                flex-direction: column;
            }

            /* Button improvements */
            .button {
                position: fixed;
                bottom: 70px;
                left: 0;
                width: 100%;
                background-color: #D9D9D9;
                padding: 10px;
                margin: 0;
                text-align: center;
                z-index: 999;
            }

            /* Improve touch targets */
            button,
            input[type="button"],
            input[type="submit"] {
                min-height: 44px;
                min-width: 44px;
                padding: 12px;
            }
        }

        /* Tablet improvements */
        @media screen and (min-width: 769px) and (max-width: 1024px) {
            .reserve button img {
                width: 250px;
                height: 250px;
            }

            .Welcome {
                margin-left: 90px;
            }

            .form-image-container {
                margin-left: 90px;
            }
        }

        /* Touch device improvements */
        @media (hover: none) {
            .reserve button:hover {
                transform: none;
            }

            .reserve button:active {
                background-color: rgba(62, 4, 8, 0.1);
            }
        }
    </style>
  </head>
  <body>
    <div class="top-bar">
 
    </div>
 
    <div class="side-bar">
      <div class="Home">
        <button type="button" id="homebutton" name="homebutton" aria-label="home" onclick="window.location.href='HoHome.html'">
          <img src="images/house.png" alt="Home" />
        </button>
        <p>Home</p>
      </div>
 
      <div class="Calendar">
        <button type="button" id="calendarbutton" name="calendarbutton" aria-label="calendar" onclick="window.location.href='calender.html'">
          <img src="images/Calendar.png" alt="calendar">
        </button>
        <p>Calendar</p>
      </div>
 
      <div class="Profile">
        <button type="button" id="profilebutton" name="profilebutton" aria-label="profile" onclick="window.location.href='profile.html'">
          <img src="images/profileicon.png" alt="Profile" />
        </button>
        <p>Profile</p>
      </div>
      <div class="button">
        <button type="button" id="logoutButton">Logout</button>
        <p>Logout</p>
      </div>
 
    </div>
 
    <div class="Welcome">
      <h1>Welcome home!</h1>
      <img
        src="/images/AvidaSettingsLogo.png"
        alt="Avida Settings Logo"
        class="avidalogo"
      />
    </div>
 
    <div class="reserve">
      <p class="reservetext1">What would you like to do?</p>
 
      <div class="reserve-item">
        <button
          type="button"
          class="poolbutton"
          id="poolbutton"
          name="poolbutton"
          aria-label="pool"
          onclick="window.location.href='addevent.html'"
        >
          <img src="images/pool.png" />
        </button>
        <p class="reservetext">Reserve for an Outing or an event?</p>
      </div>
 
      <div class="reserve-item">
        <button
          type="button"
          class="adminbutton"
          id="adminbutton"
          name="adminbutton"
          aria-label="admin"
        >
          <img src="images/admin.png" />
        </button>
        <p class="raisetext">Raise your concern to an admin</p>
      </div>
    </div>
 
    <div id="adminPopup" class="popup">
      <div class="popup-content">
          <div class="popup-top-bar">Raise a Concern</div>
          <div class="popup-content-inner">
              
              <form id="adminForm">
                  <label for="subject">Subject</label>
                  <input type="text" id="subject" name="subject" placeholder="Enter subject" required />
  
                  <label for="message">Message</label>
                
                  <textarea id="message" name="message" placeholder="Enter your message" rows="5" required></textarea>
  
                 

                  <div class="popup-buttons">
                      <button type="button" id="closePopup">Cancel</button>
                      
                      <form action="/upload" method="POST" enctype="multipart/form-data">
                        
                        <input type="file" id="fileInput" name="file" accept="image/*,application/pdf" />

                        <button type="submit" id="sendButton">Send</button>
                      </form>
                         

                          
                      
                  </div>
              </form>
          </div>
      </div>
  </div>
  <div class="notification-icon" id="notificationIcon">
    <img src="images/bell.png" alt="Notifications" />
    <span class="notification-count" id="notificationCount">0</span>
  </div>

  <div class="notification-modal" id="notificationModal">
    <span class="close-modal" id="closeModal">&times;</span>
    <h2 style="color: white;">Notifications</h2>
    <div class="notification-list" id="notificationList"></div>
    <div class="notification-actions">
      <button id="clearSelectedBtn" class="clear-btn">Clear Selected</button>
      <button id="clearAllBtn" class="clear-btn">Clear All</button>
    </div>
  </div>
  </div>
  </body>
  <script>
    function showNotification(message) {
    const notificationContent = document.getElementById('notificationContent');
    notificationContent.textContent = message;
  }
  document.addEventListener('DOMContentLoaded', function () {
    const adminButton = document.getElementById("adminbutton");
    const popup = document.getElementById("adminPopup");
    const closePopup = document.getElementById("closePopup");
    const form = document.getElementById("adminForm");
    const subject = document.getElementById('subject');
    const message = document.getElementById('message');
    const fileInput = document.getElementById("fileInput");

    // Function to format the date to the desired format
    function formatISODateWithOffset(date) {
        const isoString = date.toISOString(); // Generate standard ISO string
        return isoString.replace('Z', '+00:00'); // Replace 'Z' with '+00:00'
    }

    adminButton.addEventListener("click", () => {
        popup.style.display = "flex";
    });

    closePopup.addEventListener("click", () => {
        popup.style.display = "none";
        form.reset();
    });

    form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const selectedFile = fileInput.files[0];
        let fileData = null;

        if (selectedFile) {
            const reader = new FileReader();

            reader.onloadend = async function () {
                // Prepare the file data as base64 for sending
                fileData = reader.result.split(',')[1]; // Get base64 part after the comma

                const concernData = {
                    username: localStorage.getItem('username'),
                    email: localStorage.getItem('email'),
                    subject: subject.value,
                    message: message.value,
                    createdAt: formatISODateWithOffset(new Date()),
                    file: fileData,
                };

                try {
                    const response = await fetch('http://localhost:3000/addconcern', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json', // Set the content type as JSON
                        },
                        body: JSON.stringify(concernData), // Send JSON stringified data
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert("Your concern has been submitted successfully!");
                        form.reset();
                        popup.style.display = "none";
                    } else {
                        alert("Failed to submit the concern. Please try again.");
                    }
                } catch (error) {
                    console.error('Error submitting concern:', error);
                    alert("There was an error submitting your concern. Please try again.");
                }
            };

            reader.readAsDataURL(selectedFile); // Read file as Data URL
        } else {
            const concernData = {
                username: localStorage.getItem('username'),
                email: localStorage.getItem('email'),
                subject: subject.value,
                message: message.value,
                createdAt: formatISODateWithOffset(new Date()),
            };

            try {
                const response = await fetch('http://localhost:3000/addconcern', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json', // Set the content type as JSON
                    },
                    body: JSON.stringify(concernData), // Send JSON stringified data
                });

                const result = await response.json();

                if (result.success) {
                    alert("Your concern has been submitted successfully!");
                    form.reset();
                    popup.style.display = "none";
                } else {
                    alert("Failed to submit the concern. Please try again.");
                }
            } catch (error) {
                console.error('Error submitting concern:', error);
                alert("There was an error submitting your concern. Please try again.");
            }
        }
    });
});


document.getElementById('logoutButton').addEventListener('click', async () => {
            try {
                const response = await fetch('/logout', { method: 'POST' });
                if (response.ok) {
                    localStorage.clear(); // Clear user data
                    window.location.href = 'login.html'; // Redirect to the login page
                } else {
                    showCustomAlert('Logout failed. Please try again.');
                }
            } catch (error) {
                console.error('Error during logout:', error);
                showCustomAlert('An error occurred during logout. Please try again.');
            }
          });
 
 
 
 
              function addNotification(message) {
                  notifications.push({ message, timestamp: new Date() });
                  notificationCount.textContent = notifications.length;
                  updateNotificationList();
              }
 
              let notifications = [];
      const notificationIcon = document.getElementById('notificationIcon');
      const notificationModal = document.getElementById('notificationModal');
      const closeModal = document.getElementById('closeModal');
      const notificationList = document.getElementById('notificationList');
      const notificationCount = document.getElementById('notificationCount');
      const clearSelectedBtn = document.getElementById('clearSelectedBtn');
      const clearAllBtn = document.getElementById('clearAllBtn');

      notificationIcon.addEventListener('click', () => {
        notificationModal.style.display = 'block';
        updateNotificationList();
      });

      closeModal.addEventListener('click', () => {
        notificationModal.style.display = 'none';
      });

      async function fetchNotifications() {
  try {
    const response = await fetch('/api/notifications', {
      credentials: 'include'
    });

    const contentType = response.headers.get("content-type");
    if (contentType && contentType.indexOf("application/json") !== -1) {
      const data = await response.json();
      if (data.success) {
        notifications = data.notifications || [];
        notificationCount.textContent = data.unreadCount || '0';
        updateNotificationList();
        updateClearButtons();
      } else if (data.error === 'User not authenticated') {
        console.log('Session expired, redirecting to login');
        window.location.href = '/login.html';
      } else {
        console.error('Failed to fetch notifications:', data.error);
        handleNoNotifications();
      }
    } else {
      console.error('Received non-JSON response:', await response.text());
      window.location.href = '/login.html'; // Redirect to login if we get HTML
    }
  } catch (error) {
    console.error('Error fetching notifications:', error);
    handleNoNotifications();
  }
}

function handleNoNotifications() {
  notifications = [];
  notificationCount.textContent = '0';
  updateNotificationList();
  updateClearButtons();
}

      function updateNotificationList() {
        notificationList.innerHTML = '';

        if (notifications.length === 0) {
          const noNotificationsDiv = document.createElement('div');
          noNotificationsDiv.className = 'no-notifications';
          noNotificationsDiv.textContent = 'No notifications';
          notificationList.appendChild(noNotificationsDiv);
          return;
        }

        notifications.forEach(notification => {
          const notificationItem = document.createElement('div');
          notificationItem.className = 'notification-item';
          notificationItem.dataset.id = notification._id;

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.className = 'notification-checkbox';
          checkbox.dataset.id = notification._id;

          const contentWrapper = document.createElement('div');
          contentWrapper.className = 'notification-content';

          const message = document.createElement('div');
          message.className = 'notification-message';
          message.textContent = notification.message;

          const timestamp = document.createElement('div');
          timestamp.className = 'notification-timestamp';
          timestamp.textContent = new Date(notification.timestamp).toLocaleString();

          contentWrapper.appendChild(message);
          contentWrapper.appendChild(timestamp);

          const proceedButton = document.createElement('button');
          proceedButton.className = 'proceed-to-payment-btn';
          proceedButton.textContent = 'Proceed to Payment';
          proceedButton.addEventListener('click', () => proceedToPayment(notification));

          notificationItem.appendChild(checkbox);
          notificationItem.appendChild(contentWrapper);
          notificationItem.appendChild(proceedButton);
          notificationList.appendChild(notificationItem);
        });
      }

      function updateClearButtons() {
        clearSelectedBtn.disabled = notifications.length === 0;
        clearAllBtn.disabled = notifications.length === 0;
      }

      async function clearSelectedNotifications() {
        const selectedIds = Array.from(document.querySelectorAll('.notification-checkbox:checked'))
          .map(checkbox => checkbox.dataset.id);

        if (selectedIds.length === 0) {
          alert('No notifications selected');
          return;
        }

        try {
          const response = await fetch('/api/markNotificationsAsRead', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ notificationIds: selectedIds }),
            credentials: 'include'
          });

          if (response.ok) {
            const result = await response.json();
            if (result.success) {
              notifications = notifications.filter(n => !selectedIds.includes(n._id));
              notificationCount.textContent = notifications.length;
              updateNotificationList();
              updateClearButtons();
            }
          }
        } catch (error) {
          console.error('Error clearing selected notifications:', error);
        }
      }

      async function clearAllNotifications() {
        try {
          const response = await fetch('/api/clearAllNotifications', {
            method: 'POST',
            credentials: 'include'
          });

          if (response.ok) {
            const result = await response.json();
            if (result.success) {
              notifications = [];
              notificationCount.textContent = '0';
              updateNotificationList();
              updateClearButtons();
            }
          }
        } catch (error) {
          console.error('Error clearing all notifications:', error);
        }
      }

      clearSelectedBtn.addEventListener('click', clearSelectedNotifications);
      clearAllBtn.addEventListener('click', clearAllNotifications);

      function proceedToPayment(notification) {
        // Assuming the notification contains the eventId
        const eventId = notification.relatedId;

        // Fetch the event details
        fetch(`/api/event/${eventId}`)
          .then(response => response.json())
          .then(eventData => {
            if (eventData.success) {
              // Store the event data in sessionStorage
              sessionStorage.setItem('eventData', JSON.stringify(eventData.event));
              // Redirect to the eventfin.html page
              window.location.href = 'eventfin.html';
            } else {
              console.error('Failed to fetch event details:', eventData.message);
              alert('Failed to fetch event details. Please try again.');
            }
          })
          .catch(error => {
            console.error('Error fetching event details:', error);
            alert('An error occurred. Please try again.');
          });
      }


      // Initialize notifications
      document.addEventListener('DOMContentLoaded', () => {
        fetchNotifications();
        // Fetch notifications every 30 seconds
        setInterval(fetchNotifications, 30000);
      });

      // Close modal when clicking outside
      window.addEventListener('click', (event) => {
        if (event.target === notificationModal) {
          notificationModal.style.display = 'none';
        }
      });

      // Add this to your existing script
document.addEventListener('DOMContentLoaded', function() {
    // Improve touch handling
    document.addEventListener('touchstart', function() {}, {passive: true});

    // Handle mobile menu visibility
    const sideBar = document.querySelector('.side-bar');
    let lastScrollTop = 0;

    window.addEventListener('scroll', function() {
        if (window.innerWidth <= 768) {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > lastScrollTop) {
                // Scrolling down
                sideBar.style.transform = 'translateY(70px)';
            } else {
                // Scrolling up
                sideBar.style.transform = 'translateY(0)';
            }
            
            lastScrollTop = scrollTop;
        }
    });

    // Improve popup handling on mobile
    const popup = document.getElementById('adminPopup');
    if (popup) {
        popup.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
    }
});

function handleImageError(img) {
    console.error('Failed to load image:', img.src);
    img.src = '../images/*'; // Replace with a placeholder image
}
  </script>
</html>