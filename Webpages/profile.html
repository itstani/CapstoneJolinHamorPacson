<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Profile</title>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f8f8;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        color: #333;
      }

      .top-bar {
            background-color: #AF2630;
            position: fixed;
            color: #6b6a6a; 
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 50px; 
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            box-sizing: border-box;
            z-index: 1000;
        }

        .side-bar {
            background-color: #D9D9D9;
            position: fixed;
            color: #AF2630; 
            top: 50px;
            left: 0;
            width: 110px;
            height: 100vh; /* Full height of the viewport */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 5px;
            box-sizing: border-box;
        }

        .Home img, .homeownerstatus img, .analytics img, .Calendar img, .Profile img {
            width: 60px;
            height: 60px;
        }

        .mainarea {
            margin-left: 20px; /* Adjusted to align with the sidebar */
            padding: 20px;
            box-sizing: border-box;
        }

        .Home, .homeownerstatus, .analytics, .Calendar, .Profile {
            margin-bottom: 20px;
            text-align: center;
            font-size: 15px;
            font-weight: bold;
            font-family: 'Inter';
            padding-top: 5px;
        }

        .Home button, .homeownerstatus button, .analytics button, .Calendar button,.Profile button {
            background-color: #D9D9D9;
            margin: 0 auto;
            border: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
        }

        .Home button:hover, .homeownerstatus button:hover, .analytics button:hover, .Calendar button:hover, .Profile button:hover {
            background-color: #ccc;
            cursor: pointer;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

      /* Container */
      .container {
      display: flex;
      justify-content: space-between;
      margin: 20px auto;
      max-width: 1200px;
      gap: 20px;
    }

      h2 {
        color: #af2630;
        font-size: 24px;
        margin-bottom: 15px;
      }

      .profile-card {
        background-color: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        width: 100%;
        text-align: center;
      }

      .edit-container {
        display: none; /* Initially hidden */
        background-color: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        width: 100%;
        text-align: center;
      }

      .profile-item {
        margin: 15px 0;
        padding: 10px;
        background-color: #f8f8f8;
        border-radius: 8px;
        font-size: 18px;
        display: flex;
        justify-content: space-between;
      }

      .profile-item span {
        font-weight: bold;
        color: #333;
      }

      /* Buttons */
      .button {
        margin: 15px 5px;
        padding: 10px 20px;
        border: none;
        border-radius: 20px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .edit-profile-button {
        background-color: #af2630;
        color: white;
      }

      .edit-profile-button:hover {
        background-color: #8c2027;
      }

      .logout-button {
        background-color: #af2630;
        color: white;
      }

      .logout-button:hover {
        background-color: #ccc;
      }

      .save-button {
        background-color: #af2630;
        color: white;
      }

      .save-button:hover {
        background-color: #8c2027;
      }

      .cancel-button {
        background-color: #ddd;
        color: #af2630;
      }

      .cancel-button:hover {
        background-color: #ccc;
      }
    
      .Profile img{
        width: 60px;
        height: 60px;
       
      }

 

      /* Responsive adjustments for smaller screens */
      @media (max-width: 600px) {
        .search-bar {
          width: 100%;
        }

        .top-bar {
          padding: 0 10px;
        }

        .reserve {
          flex-direction: column; /* Stack buttons vertically on small screens */
          gap: 20px;
        }

        .reservetext1 {
          font-size: 30px; /* Adjust the size for smaller screens */
        }
      }
      

   

    </style>
  </head>
  <body>
    <div class="top-bar">User Profile</div>
    
    <div class="side-bar">
      <div class="Home">
        <button type="button" id="homebutton" name="homebutton" aria-label="home" onclick="window.location.href='HoHome.html'">
          <img src="images/house.png" alt="Home" />
        </button>
        <p>Home</p>
      </div>

      <div class="Calendar">
        <button type="button" id="calendarbutton" name="calendarbutton" aria-label="calendar" onclick="window.location.href='calender.html'">
          <img src="images/Calendar.png" alt="calendar">
        </button>
        <p>Calendar</p>
      </div>
    

      <button class="button logout-button" onclick="logout()">Logout</button>
    </div>

      <div class="container">
        <!-- Profile Card Section -->
        <div class="profile-card">
          <h2>Profile</h2>
          <p><strong>Username:</strong> <span id="username"></span></p>
          <p><strong>Email:</strong> <span id="email"></span></p>
          <p><strong>Name:</strong> <span id="full-name"></span></p>
          <p><strong>Status:</strong> <span id="status"></span></p>
          <button class="button edit-profile-button" onclick="toggleEditProfile()">Edit Profile</button>
        </div>
  
        <!-- Edit Profile Section -->
        <div class="edit-container">
          <h2>Edit Your Profile</h2>
          <form id="editProfileForm">
            <div class="profile-item">
              <span>Username:</span>
              <input type="text" id="edit-username" class="editable" />
            </div>
            <div class="profile-item">
              <span>Password:</span>
              <input type="password" id="edit-password" class="editable" />
            </div>
            <button type="submit" class="button save-button">Save Changes</button>
            <button type="button" class="button cancel-button" onclick="toggleEditProfile()">Cancel</button>
          </form>
        </div>
    
    
      
      </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        fetch("http://localhost:3000/profile", {
          method: 'GET',
          credentials: 'include' // This is important for sending cookies
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              document.getElementById("username").textContent = data.username;
              document.getElementById("email").textContent = data.email;
              document.getElementById("full-name").textContent = `${data.firstname} ${data.lastname}`;
              document.getElementById("status").textContent = data.status;

              document.getElementById("edit-username").value = data.username;
            } else {
              alert("Please log in to view your profile.");
              window.location.href = "/login.html"; // Redirect to login page
            }
          })
          .catch(err => {
            console.error("Error fetching profile:", err);
            alert("An error occurred. Please try again later.");
          });
      });



      function toggleEditProfile() {
        const editContainer = document.querySelector(".edit-container");
        editContainer.style.display =
          editContainer.style.display === "none" || !editContainer.style.display
            ? "block"
            : "none";
      }

      document.getElementById("editProfileForm").addEventListener("submit", (e) => {
        e.preventDefault();

        const updatedData = {
          newUsername: document.getElementById("edit-username").value.trim(),
          password: document.getElementById("edit-password").value.trim()
        };

        fetch("http://localhost:3000/updateProfile", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(updatedData),
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert("Profile updated successfully.");
              window.location.reload();
            } else {
              alert("Failed to update profile. " + data.message);
            }
          })
          .catch(err => console.error("Error updating profile:", err));
      });

      function logout() {
        fetch("http://localhost:3000/logout", { method: "POST" })
          .then(() => {
            window.location.href = "/";
          })
          .catch((err) => {
            console.error("Logout error:", err);
          });
      }

      function logout() {
        fetch("http://localhost:3000/logout", { method: "POST" })
          .then(() => {
            window.location.href = "/"; 
          })
          .catch((err) => {
            console.error("Logout error:", err);
          });
      }

      

    </script>
  </body>
</html>
